<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Truck ETA Calculator v1.1</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    body { background-color: #f4f4f4; }
    .calculator {
      background: #fff; padding: 20px; border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-top: 20px;
    }
    #result { white-space: pre-line; }
    .floating-lang-btn {
      position: fixed; top: 15%; left: 0; z-index: 1050;
    }
    .badge-dot {
      display:inline-block; width:10px; height:10px; border-radius:50%;
      margin-right:6px; background:#0d6efd;
    }
  </style>
</head>
<body>

<!-- Floating Language Selector Button -->
<button class="btn btn-secondary btn-sm floating-lang-btn" data-bs-toggle="offcanvas" data-bs-target="#offcanvasLanguage" aria-controls="offcanvasLanguage">
  US
</button>

<!-- Offcanvas Sidebar for Language Selection -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasLanguage" aria-labelledby="offcanvasLabel">
  <div class="offcanvas-header">
    <h5 id="offcanvasLabel">Select Language</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <select id="languageSelect" class="form-select" onchange="updateLocalization()">
      <option value="en">English</option>
      <option value="lt">Lietuvių</option>
      <option value="ru">Русский</option>
    </select>
  </div>
</div>

<div class="container">
  <div class="calculator">
    <div class="d-flex align-items-center justify-content-between">
      <h2 id="calcTitle" class="mb-4">Truck ETA Calculator v1.1 (Interactive Delay Adjustment)</h2>
      <span class="text-muted">v1.1</span>
    </div>

    <!-- Controls row -->
    <div class="row g-3">
      <div class="col-md-4">
        <label for="startTime" class="form-label" id="startTimeLabel">Start Time:</label>
        <input type="text" id="startTime" class="form-control">
      </div>

      <div class="col-md-4">
        <p id="drivingConfigLabel" class="fw-bold mb-1">Driving Configuration:</p>
        <div class="form-check">
          <input type="radio" class="form-check-input" id="single" name="driverType" value="single" checked>
          <label for="single" class="form-check-label" id="singleDriverLabel">Single Driver (9h available per segment)</label>
        </div>
        <div class="form-check">
          <input type="radio" class="form-check-input" id="two" name="driverType" value="two">
          <label for="two" class="form-check-label" id="twoDriversLabel">Two Drivers (18h available per segment)</label>
        </div>
      </div>

      <div class="col-md-4">
        <label for="customHours" class="form-label" id="customHoursLabel">Custom remaining driving time for first segment (optional):</label>
        <input type="number" id="customHours" placeholder="e.g., 6" step="0.1" class="form-control">
      </div>

      <div class="col-md-4">
        <label for="distance" class="form-label" id="distanceLabel">Distance to Drive (km):</label>
        <input type="number" id="distance" step="0.1" class="form-control">
      </div>

      <div class="col-md-4">
        <label for="speed" class="form-label" id="speedLabel">Average Speed (km/h):</label>
        <input type="number" id="speed" step="0.1" class="form-control">
      </div>

      <!-- Refuelings input -->
      <div class="col-md-4">
        <label for="refuels" class="form-label" id="refuelsLabel">Number of Refuelings (each 1h delay):</label>
        <input type="number" id="refuels" min="0" max="10" value="0" class="form-control">
      </div>

      <!-- Ferry time -->
      <div class="col-md-4">
        <label for="ferryTime" class="form-label" id="ferryTimeLabel">Total Ferry Time (minutes delay):</label>
        <input type="number" id="ferryTime" min="0" value="0" class="form-control">
      </div>

      <!-- Options -->
      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            <div class="form-check form-switch mb-2">
              <input class="form-check-input" type="checkbox" id="autoFerryRestToggle" checked>
              <label class="form-check-label" for="autoFerryRestToggle" id="autoFerryRestLabel">
                Auto-convert any ferry ≥ 6h into a daily rest
              </label>
            </div>
            <div class="small text-muted" id="dutyRuleNote">
              Delays are off-duty by default; they will count inside duty as needed to keep daily spread ≤ 15h (single) or 21h (two).
            </div>
            <div class="mt-2">
              <span class="badge-dot"></span>
              <span id="reducedRestsInfo">Reduced (9h) daily rests used this week: <strong id="reducedCount">0</strong>/2</span>
              <button id="resetWeekBtn" class="btn btn-sm btn-outline-secondary ms-2">Reset week counter</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Ferry assignment container (shown only if ferry > 0) -->
      <div class="col-12" id="ferryAssignmentContainer" style="display:none;">
        <div class="card mt-2">
          <div class="card-body">
            <h5 id="ferryDelayAssignmentHeader" class="mb-3">Ferry Delay Assignment</h5>
            <label for="ferrySegment" class="form-label" id="ferrySegmentLabel">Apply Ferry Delay in segment (number):</label>
            <input type="number" id="ferrySegment" min="1" value="1" class="form-control" style="max-width:200px;">
          </div>
        </div>
      </div>

      <!-- Refuel assignment container -->
      <div class="col-12">
        <div class="card mt-2">
          <div class="card-body">
            <div id="refuelAssignmentsContainer"></div>
          </div>
        </div>
      </div>

    </div><!-- /row -->

    <!-- Calculate button -->
    <div class="mt-4">
      <button id="calcTripButton" onclick="calculateTripAndDisplay()" class="btn btn-primary">Calculate Trip</button>
    </div>

    <!-- Trip Breakdown & Results -->
    <div class="accordion mt-4" id="tripBreakdownAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingBreakdown">
          <button id="tripBreakdownAccordionButton" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBreakdown" aria-expanded="false" aria-controls="collapseBreakdown">
            Trip Breakdown & Results
          </button>
        </h2>
        <div id="collapseBreakdown" class="accordion-collapse collapse" aria-labelledby="headingBreakdown" data-bs-parent="#tripBreakdownAccordion">
          <div class="accordion-body" id="result"><!-- results injected here --></div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="js/i18n.js"></script>
<script src="js/etaCalc.js"></script>
</body>
</html>
